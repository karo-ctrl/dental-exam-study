<!DOCTYPE html>
<html lang="ja" data-theme="light" data-mode="quiz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>歯科国試 学習</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    (function() {
      var saved = localStorage.getItem("dentalExamState");
      if (saved) {
        var data = JSON.parse(saved);
        if (data.theme === "dark") {
          document.documentElement.setAttribute("data-theme", "dark");
        }
        if (data.mode) {
          document.documentElement.setAttribute("data-mode", data.mode);
        }
      }
    })();
  </script>
</head>
<body>
  <header class="header">
    <button class="btn-icon" id="backBtn" aria-label="戻る" style="display: none;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button class="btn-icon" id="menuBtn" aria-label="メニュー">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <h1 class="header-title" id="headerTitle">過去問</h1>
    <div class="header-actions">
      <button class="btn-icon" id="themeBtn" aria-label="テーマ切替">
        <svg class="icon-sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="icon-moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
      <button class="btn-icon" id="settingsBtn" aria-label="設定">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </div>
  </header>


  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2 id="sidebarTitle">試験選択</h2>
      <button class="btn-icon" id="closeSidebarBtn" aria-label="閉じる">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav class="sidebar-nav">
      <div id="examList" class="exam-list"></div>
      <div id="categoryList" class="category-list" style="display: none;"></div>
      <div id="topicList" class="topic-list" style="display: none;"></div>
    </nav>
  </aside>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <aside class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h2>設定</h2>
      <button class="btn-icon" id="closeSettingsBtn" aria-label="閉じる">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="settings-content">
      <div class="setting-item">
        <label>テーマ</label>
        <div class="theme-options">
          <button class="theme-option active" data-theme="light">ライト</button>
          <button class="theme-option" data-theme="dark">ダーク</button>
          <button class="theme-option" data-theme="auto">自動</button>
        </div>
      </div>
      <div class="setting-item">
        <label>文字サイズ</label>
        <div class="font-size-control">
          <button class="btn-small" id="fontDecrease">A-</button>
          <span id="fontSizeDisplay">100%</span>
          <button class="btn-small" id="fontIncrease">A+</button>
        </div>
      </div>
      <div class="setting-item">
        <label>今日の問題数</label>
        <div class="today-stats">
          <span class="today-count" id="todayCount">0</span>
          <span class="today-diff" id="todayDiff"></span>
        </div>
      </div>
      <div class="setting-item setting-item-login">
        <button class="btn-login" id="loginBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
            <polyline points="10 17 15 12 10 7"></polyline>
            <line x1="15" y1="12" x2="3" y2="12"></line>
          </svg>
          ログイン
        </button>
      </div>
    </div>
  </aside>
  <div class="settings-overlay" id="settingsOverlay"></div>

  <!-- 出題設定パネル -->
  <aside class="quiz-settings-panel" id="quizSettingsPanel">
    <div class="quiz-settings-header">
      <button class="btn-icon" id="closeQuizSettingsBtn" aria-label="閉じる">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>出題設定</h2>
    </div>
    <div class="quiz-settings-content">
      <!-- 必修の設定 -->
      <div class="settings-section" data-section="hisshu">
        <button class="settings-section-header" data-toggle="hisshu">
          <span class="section-title">必修の設定</span>
          <svg class="section-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="settings-section-body" id="hisshuSettings">
          <div class="setting-row">
            <label>出題数</label>
            <select id="hisshuCount" class="setting-select">
              <option value="10">10問</option>
              <option value="20" selected>20問</option>
              <option value="30">30問</option>
              <option value="50">50問</option>
              <option value="all">全問</option>
            </select>
          </div>
          <div class="setting-row">
            <label>出題範囲（大項目）</label>
            <div class="range-buttons" id="hisshuRange">
              <button class="range-btn active" data-value="1">1</button>
              <button class="range-btn active" data-value="2">2</button>
              <button class="range-btn active" data-value="3">3</button>
              <button class="range-btn active" data-value="4">4</button>
              <button class="range-btn active" data-value="5">5</button>
              <button class="range-btn active" data-value="6">6</button>
              <button class="range-btn active" data-value="7">7</button>
              <button class="range-btn active" data-value="8">8</button>
              <button class="range-btn active" data-value="9">9</button>
              <button class="range-btn active" data-value="10">10</button>
              <button class="range-btn active" data-value="11">11</button>
              <button class="range-btn active" data-value="12">12</button>
            </div>
          </div>
          <div class="setting-row">
            <label>出題条件</label>
            <div class="condition-buttons" id="hisshuCondition">
              <button class="condition-btn active" data-value="unanswered">未出題</button>
              <button class="condition-btn" data-value="incorrect1">1回不正解</button>
              <button class="condition-btn" data-value="incorrect2">2回不正解</button>
              <button class="condition-btn" data-value="incorrect3">3回以上不正解</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 一般の設定 -->
      <div class="settings-section" data-section="ippan">
        <button class="settings-section-header" data-toggle="ippan">
          <span class="section-title">一般の設定</span>
          <svg class="section-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="settings-section-body collapsed" id="ippanSettings">
          <div class="setting-row">
            <label>出題数</label>
            <select id="ippanCount" class="setting-select">
              <option value="10" selected>10問</option>
              <option value="20">20問</option>
              <option value="30">30問</option>
              <option value="50">50問</option>
              <option value="all">全問</option>
            </select>
          </div>
          <div class="setting-row">
            <label>出題範囲（科目）</label>
            <div class="range-buttons subject-buttons" id="ippanRange">
              <button class="range-btn active" data-value="解剖学">解剖学</button>
              <button class="range-btn active" data-value="組織学">組織学</button>
              <button class="range-btn active" data-value="病理学">病理学</button>
              <button class="range-btn active" data-value="生理学">生理学</button>
              <button class="range-btn active" data-value="生化学">生化学</button>
              <button class="range-btn active" data-value="微生物学">微生物学</button>
              <button class="range-btn active" data-value="薬理学">薬理学</button>
              <button class="range-btn active" data-value="歯科理工学">歯科理工学</button>
              <button class="range-btn active" data-value="衛生">衛生</button>
              <button class="range-btn active" data-value="保存修復学">保存修復学</button>
              <button class="range-btn active" data-value="歯内療法学">歯内療法学</button>
              <button class="range-btn active" data-value="歯周病学">歯周病学</button>
              <button class="range-btn active" data-value="有床義歯補綴学">有床義歯</button>
              <button class="range-btn active" data-value="冠橋補綴学">冠橋補綴</button>
              <button class="range-btn active" data-value="インプラント">インプラント</button>
              <button class="range-btn active" data-value="口腔外科学">口腔外科</button>
              <button class="range-btn active" data-value="矯正歯科学">矯正</button>
              <button class="range-btn active" data-value="小児歯科学">小児</button>
              <button class="range-btn active" data-value="高齢者歯科学">高齢者</button>
              <button class="range-btn active" data-value="障害者歯科学">障害者</button>
              <button class="range-btn active" data-value="放射線学">放射線</button>
              <button class="range-btn active" data-value="麻酔学">麻酔</button>
              <button class="range-btn active" data-value="総合医学">総合医学</button>
            </div>
          </div>
          <div class="setting-row">
            <label>出題条件</label>
            <div class="condition-buttons" id="ippanCondition">
              <button class="condition-btn active" data-value="unanswered">未出題</button>
              <button class="condition-btn" data-value="incorrect1">1回不正解</button>
              <button class="condition-btn" data-value="incorrect2">2回不正解</button>
              <button class="condition-btn" data-value="incorrect3">3回以上不正解</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 臨実の設定 -->
      <div class="settings-section" data-section="rinjitsu">
        <button class="settings-section-header" data-toggle="rinjitsu">
          <span class="section-title">臨実の設定</span>
          <svg class="section-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="settings-section-body collapsed" id="rinjitsuSettings">
          <div class="setting-row">
            <label>出題数</label>
            <select id="rinjitsuCount" class="setting-select">
              <option value="10" selected>10問</option>
              <option value="20">20問</option>
              <option value="30">30問</option>
              <option value="50">50問</option>
              <option value="all">全問</option>
            </select>
          </div>
          <div class="setting-row">
            <label>出題範囲（科目）</label>
            <div class="range-buttons subject-buttons" id="rinjitsuRange">
              <button class="range-btn active" data-value="解剖学">解剖学</button>
              <button class="range-btn active" data-value="組織学">組織学</button>
              <button class="range-btn active" data-value="病理学">病理学</button>
              <button class="range-btn active" data-value="生理学">生理学</button>
              <button class="range-btn active" data-value="生化学">生化学</button>
              <button class="range-btn active" data-value="微生物学">微生物学</button>
              <button class="range-btn active" data-value="薬理学">薬理学</button>
              <button class="range-btn active" data-value="歯科理工学">歯科理工学</button>
              <button class="range-btn active" data-value="衛生">衛生</button>
              <button class="range-btn active" data-value="保存修復学">保存修復学</button>
              <button class="range-btn active" data-value="歯内療法学">歯内療法学</button>
              <button class="range-btn active" data-value="歯周病学">歯周病学</button>
              <button class="range-btn active" data-value="有床義歯補綴学">有床義歯</button>
              <button class="range-btn active" data-value="冠橋補綴学">冠橋補綴</button>
              <button class="range-btn active" data-value="インプラント">インプラント</button>
              <button class="range-btn active" data-value="口腔外科学">口腔外科</button>
              <button class="range-btn active" data-value="矯正歯科学">矯正</button>
              <button class="range-btn active" data-value="小児歯科学">小児</button>
              <button class="range-btn active" data-value="高齢者歯科学">高齢者</button>
              <button class="range-btn active" data-value="障害者歯科学">障害者</button>
              <button class="range-btn active" data-value="放射線学">放射線</button>
              <button class="range-btn active" data-value="麻酔学">麻酔</button>
              <button class="range-btn active" data-value="総合医学">総合医学</button>
            </div>
          </div>
          <div class="setting-row">
            <label>出題条件</label>
            <div class="condition-buttons" id="rinjitsuCondition">
              <button class="condition-btn active" data-value="unanswered">未出題</button>
              <button class="condition-btn" data-value="incorrect1">1回不正解</button>
              <button class="condition-btn" data-value="incorrect2">2回不正解</button>
              <button class="condition-btn" data-value="incorrect3">3回以上不正解</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="quiz-settings-footer">
      <button class="btn-save-settings" id="saveQuizSettingsBtn">設定を保存</button>
    </div>
  </aside>
  <div class="quiz-settings-overlay" id="quizSettingsOverlay"></div>

  <main class="main">
    <!-- 過去問ホーム画面 -->
    <div id="kakomonHome" class="home-screen">
      <div class="home-content">
        <div class="search-section-home search-section-top">
          <h2 class="section-title">科目・回数別出題</h2>
          <button class="daily-btn daily-btn-search-large" id="examSelectBtn">
            <div class="daily-btn-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
            <div class="daily-btn-content">
              <span class="daily-btn-title">科目・回数を選んで出題</span>
              <span class="daily-btn-count">好きな条件で演習</span>
            </div>
            <svg class="daily-btn-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>

        <div class="daily-section daily-section-bottom">
          <h2 class="section-title">今日の問題</h2>
          <button class="daily-btn daily-btn-hisshu" id="dailyHisshuBtn">
            <div class="daily-btn-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <div class="daily-btn-content">
              <span class="daily-btn-title">今日の必修</span>
              <span class="daily-btn-count">20問</span>
            </div>
            <svg class="daily-btn-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <button class="daily-btn daily-btn-ippan" id="dailyIppanBtn">
            <div class="daily-btn-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
            </div>
            <div class="daily-btn-content">
              <span class="daily-btn-title">今日の一般</span>
              <span class="daily-btn-count">10問</span>
            </div>
            <svg class="daily-btn-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <button class="daily-btn daily-btn-rinjitsu" id="dailyRinjitsuBtn">
            <div class="daily-btn-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                <path d="M9 14l2 2 4-4"></path>
              </svg>
            </div>
            <div class="daily-btn-content">
              <span class="daily-btn-title">今日の臨実</span>
              <span class="daily-btn-count">10問</span>
            </div>
            <svg class="daily-btn-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <button class="menu-btn menu-btn-settings" id="settingsMenuBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            出題設定
          </button>
        </div>
      </div>
    </div>

    <!-- オリジナルホーム画面 -->
    <div id="originalHome" class="home-screen" style="display: none;">
      <div class="home-content">
        <!-- マイデッキセクション -->
        <div class="original-section">
          <div class="original-section-header">
            <h2 class="section-title">マイデッキ</h2>
            <button class="btn-add-deck" id="addDeckBtn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              新規作成
            </button>
          </div>
          <div class="deck-list" id="deckList">
            <p class="empty-message">まだデッキがありません。新規作成ボタンからデッキを作成しましょう。</p>
          </div>
        </div>

        <!-- インポートセクション -->
        <div class="original-import-section">
          <button class="btn-import-deck" id="importDeckBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            デッキをインポート
          </button>
          <input type="file" id="deckFileInput" accept=".json" style="display: none;">
        </div>
      </div>
    </div>

    <!-- デッキ詳細画面 -->
    <div id="deckDetailScreen" class="quiz-screen" style="display: none;">
      <div class="deck-detail-container">
        <div class="deck-detail-header">
          <div class="deck-detail-info">
            <h2 id="deckDetailName">デッキ名</h2>
            <p id="deckDetailDescription" class="deck-detail-desc"></p>
            <div class="deck-detail-stats">
              <span id="deckDetailCardCount">0枚</span>
              <span class="stats-separator">|</span>
              <span id="deckDetailAccuracy">正解率: --</span>
            </div>
          </div>
          <div class="deck-detail-actions">
            <button class="btn-icon" id="editDeckBtn" title="デッキを編集">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            <button class="btn-icon btn-danger" id="deleteDeckBtn" title="デッキを削除">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
            <button class="btn-icon" id="exportDeckBtn" title="デッキをエクスポート">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- 演習開始ボタン -->
        <button class="btn-start-practice" id="startPracticeBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          演習を開始
        </button>

        <!-- カードリスト -->
        <div class="card-list-section">
          <div class="card-list-header">
            <h3>カード一覧</h3>
            <button class="btn-add-card" id="addCardBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              カード追加
            </button>
          </div>
          <div class="card-list" id="deckCardList">
            <p class="empty-message">まだカードがありません。カード追加ボタンから追加しましょう。</p>
          </div>
        </div>
      </div>
    </div>

    <!-- フラッシュカード演習画面 -->
    <div id="flashcardScreen" class="quiz-screen" style="display: none;">
      <div class="flashcard-container">
        <div class="flashcard-progress">
          <span id="flashcardProgress">1 / 10</span>
          <div class="flashcard-progress-bar">
            <div class="flashcard-progress-fill" id="flashcardProgressFill"></div>
          </div>
        </div>

        <div class="flashcard" id="flashcard">
          <div class="flashcard-inner" id="flashcardInner">
            <div class="flashcard-front">
              <div class="flashcard-content" id="flashcardFront">質問</div>
              <p class="flashcard-hint">タップして答えを見る</p>
            </div>
            <div class="flashcard-back">
              <div class="flashcard-content" id="flashcardBack">答え</div>
            </div>
          </div>
        </div>

        <div class="flashcard-buttons" id="flashcardButtons" style="display: none;">
          <button class="btn-incorrect" id="btnIncorrect">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            わからなかった
          </button>
          <button class="btn-correct" id="btnCorrect">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            わかった
          </button>
        </div>
      </div>
    </div>

    <!-- 演習結果画面 -->
    <div id="flashcardResultScreen" class="quiz-screen" style="display: none;">
      <div class="flashcard-result-container">
        <div class="result-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <h2 class="result-title">演習完了！</h2>
        <div class="result-stats">
          <div class="result-stat">
            <span class="result-stat-value" id="resultCorrect">0</span>
            <span class="result-stat-label">正解</span>
          </div>
          <div class="result-stat">
            <span class="result-stat-value" id="resultIncorrect">0</span>
            <span class="result-stat-label">不正解</span>
          </div>
          <div class="result-stat">
            <span class="result-stat-value" id="resultAccuracy">0%</span>
            <span class="result-stat-label">正解率</span>
          </div>
        </div>
        <div class="result-buttons">
          <button class="btn-retry" id="btnRetryPractice">もう一度</button>
          <button class="btn-back-to-deck" id="btnBackToDeck">デッキに戻る</button>
        </div>
      </div>
    </div>

    <!-- 成績管理ホーム画面 -->
    <div id="statsHome" class="home-screen" style="display: none;">
      <div class="home-content">
        <!-- 学習統計セクション（トグル） -->
        <div class="stats-toggle-section open" id="learningStatsSection">
          <button class="stats-toggle-header" data-toggle="learning">
            <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span class="toggle-title">学習統計</span>
          </button>
          <div class="stats-toggle-content">
            <!-- 今日の統計カード -->
            <div class="stats-today-card">
              <div class="stats-today-main">
                <div class="stats-today-value" id="statsTodayCount">0</div>
                <div class="stats-today-label">今日の問題数</div>
              </div>
              <div class="stats-today-compare" id="statsTodayCompare">
                <span class="compare-badge neutral">--</span>
                <span class="compare-label">前週平均比</span>
              </div>
            </div>

            <!-- 総合統計 -->
            <div class="stats-summary-grid">
              <div class="stats-summary-item">
                <div class="stats-summary-value" id="statsTotalQuestions">0</div>
                <div class="stats-summary-label">総回答数</div>
              </div>
              <div class="stats-summary-item">
                <div class="stats-summary-value" id="statsTotalAccuracy">--%</div>
                <div class="stats-summary-label">正答率</div>
              </div>
              <div class="stats-summary-item">
                <div class="stats-summary-value" id="statsStreak">0</div>
                <div class="stats-summary-label">連続日数</div>
              </div>
            </div>

            <!-- 週間グラフ -->
            <div class="stats-chart-section">
              <div class="stats-chart-header">
                <span class="stats-chart-title">週間学習推移</span>
                <div class="stats-chart-tabs">
                  <button class="stats-chart-tab active" data-period="week">週間</button>
                  <button class="stats-chart-tab" data-period="month">月間</button>
                </div>
              </div>
              <div class="stats-bar-chart" id="statsBarChart">
                <!-- グラフがJSで描画される -->
              </div>
            </div>

            <!-- 科目別正答率 -->
            <div class="stats-subject-section" id="statsSubjectSection" style="display: none;">
              <div class="stats-subject-header">科目別正答率</div>
              <div class="stats-subject-list" id="statsSubjectList">
                <!-- 科目別データがJSで追加される -->
              </div>
            </div>
          </div>
        </div>

        <!-- 模試成績セクション（トグル） -->
        <div class="stats-toggle-section open" id="mockExamSection">
          <button class="stats-toggle-header" data-toggle="mock">
            <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span class="toggle-title">模試成績</span>
            <button class="btn-add-mock" id="addMockExamBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              追加
            </button>
          </button>
          <div class="stats-toggle-content">
            <!-- 模試成績リスト -->
            <div class="mock-exam-list" id="mockExamList">
              <p class="empty-message">まだ模試成績が登録されていません。</p>
            </div>

            <!-- 成績推移グラフ -->
            <div class="mock-chart-section" id="mockChartSection" style="display: none;">
              <div class="mock-chart-header">成績推移</div>
              <div class="mock-line-chart" id="mockLineChart">
                <!-- グラフがJSで描画される -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- まとめホーム画面 -->
    <div id="summaryHome" class="home-screen" style="display: none;">
      <div class="home-content">
        <!-- 検索バー -->
        <div class="summary-search-section">
          <div class="summary-search-bar">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="summarySearchInput" class="summary-search-input" placeholder="キーワードで検索...">
            <button class="summary-search-clear" id="summarySearchClear" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- 検索結果（検索時のみ表示） -->
        <div class="summary-search-results" id="summarySearchResults" style="display: none;">
          <div class="search-results-header">
            <span id="searchResultsCount">0件の結果</span>
          </div>
          <div class="search-results-list" id="searchResultsList"></div>
        </div>

        <!-- ランキング（トグル） -->
        <div class="summary-toggle-section open" id="summaryRankingSection">
          <button class="summary-toggle-header" data-toggle="ranking">
            <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span class="toggle-title">ランキング</span>
            <svg class="ranking-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ffc107" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
          </button>
          <div class="summary-toggle-content" id="rankingToggleContent">
            <div class="ranking-tabs">
              <button class="ranking-tab active" data-period="weekly">週間TOP5</button>
              <button class="ranking-tab" data-period="yearly">年間TOP5</button>
            </div>
            <div class="ranking-list" id="rankingList">
              <p class="empty-message">ランキングデータを読み込み中...</p>
            </div>
          </div>
        </div>

        <!-- お気に入り（トグル） -->
        <div class="summary-toggle-section" id="summaryFavoritesSection">
          <button class="summary-toggle-header" data-toggle="favorites">
            <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span class="toggle-title">お気に入り</span>
            <span class="toggle-badge" id="favoritesCount">0</span>
          </button>
          <div class="summary-toggle-content" id="favoritesToggleContent">
            <div class="favorites-list" id="favoritesList">
              <p class="empty-message">お気に入りに追加したまとめがありません</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- まとめカテゴリ一覧画面 -->
    <div id="summaryCategoryScreen" class="quiz-screen" style="display: none;">
      <div class="summary-list-container">
        <div class="summary-list-header">
          <h2 id="summaryCategoryTitle">解剖学</h2>
          <span id="summaryCategoryCount">0件</span>
        </div>
        <div class="summary-topics-list" id="summaryTopicsList"></div>
      </div>
    </div>

    <!-- 問題表示画面 -->
    <div id="quizScreen" class="quiz-screen" style="display: none;">
      <div class="card-container">
        <div id="loadingState" class="loading-state">
          <p>データ読み込み中...</p>
        </div>

      <article id="quizCard" class="card quiz-card" style="display: none;">
        <div class="card-header">
          <span id="cardCategory" class="card-category">A問題</span>
          <button id="quizFavoriteBtn" class="btn-icon btn-favorite" aria-label="お気に入り">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
          </button>
        </div>
        <div class="question-id-row">
          <div id="questionId" class="question-id">117-A001</div>
          <div id="questionSource" class="question-source">出典：第117回歯科医師国家試験（厚生労働省）</div>
        </div>
        <h2 id="cardTitle" class="card-title">問題文がここに表示されます</h2>
        <div id="imageRef" class="image-ref" style="display: none;">
          <div class="image-ref-header">
            <span class="image-badge">画像</span>
            <span id="imageRefText"></span>
          </div>
          <div id="imageThumbnails" class="image-thumbnails"></div>
        </div>
        <div id="choicesContainer" class="choices-container"></div>
        <div id="answerArea" class="answer-area" style="display: none;">
          <div class="answer-label">正解</div>
          <div id="correctAnswer" class="correct-answer"></div>
        </div>
        <div id="relatedSummaries" class="related-summaries" style="display: none;">
          <div class="related-summaries-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
            <span>関連まとめ</span>
          </div>
          <div id="relatedSummariesList" class="related-summaries-list"></div>
        </div>
        <div class="card-actions">
          <button id="showAnswerBtn" class="btn-answer">解答を見る</button>
          <button id="nextQuestionBtn" class="btn-next" style="display: none;">次の問題</button>
          <div id="difficultyBtns" class="difficulty-btns" style="display: none;">
            <button class="difficulty-btn difficulty-easy" data-difficulty="easy">簡単</button>
            <button class="difficulty-btn difficulty-normal" data-difficulty="normal">普通</button>
            <button class="difficulty-btn difficulty-hard" data-difficulty="hard">難しい</button>
          </div>
        </div>
      </article>

      <article id="summaryCard" class="card summary-card" style="display: none;">
        <div class="card-header">
          <div class="summary-breadcrumb">
            <span id="summaryCategory" class="breadcrumb-item">解剖学</span>
            <span class="breadcrumb-sep">/</span>
            <span id="summaryTopic" class="breadcrumb-item">頭蓋骨</span>
          </div>
          <button id="summaryFavoriteBtn" class="btn-icon btn-favorite" aria-label="お気に入り">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
          </button>
        </div>
        <h2 id="summaryTitle" class="card-title">カードタイトル</h2>
        <div id="summaryContent" class="summary-content">
          <p>まとめ内容がここに表示されます。</p>
        </div>
        <div id="keyPoints" class="key-points" style="display: none;">
          <div class="key-points-label">ポイント</div>
          <ul id="keyPointsList"></ul>
        </div>
        <div id="textbookRefs" class="textbook-refs" style="display: none;">
          <div class="refs-label">参照ページ</div>
          <div id="textbookRefsList" class="refs-list"></div>
        </div>
        <div id="relatedExams" class="related-exams" style="display: none;">
          <div class="refs-label">関連問題</div>
          <div id="relatedExamsList" class="refs-list"></div>
        </div>
        <div id="summaryTags" class="summary-tags"></div>
      </article>
      </div>
    </div>
  </main>

  <!-- 問題ナビゲーション（問題表示時のみ） -->
  <div class="question-nav" id="questionNav" style="display: none;">
    <button id="prevBtn" class="btn-nav" disabled>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      前へ
    </button>
    <span class="card-counter">
      <span id="currentIndex">0</span> / <span id="totalCards">0</span>
    </span>
    <button id="nextBtn" class="btn-nav">
      次へ
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>

  <!-- 下部ナビゲーション -->
  <nav class="bottom-nav" id="bottomNav">
    <button class="bottom-nav-item active" data-tab="kakomon">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
      </svg>
      <span>過去問</span>
    </button>
    <button class="bottom-nav-item" data-tab="original">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
        <line x1="8" y1="21" x2="16" y2="21"></line>
        <line x1="12" y1="17" x2="12" y2="21"></line>
      </svg>
      <span>オリジナル</span>
    </button>
    <button class="bottom-nav-item" data-tab="summary">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
      </svg>
      <span>まとめ</span>
    </button>
    <button class="bottom-nav-item" data-tab="stats">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="20" x2="18" y2="10"></line>
        <line x1="12" y1="20" x2="12" y2="4"></line>
        <line x1="6" y1="20" x2="6" y2="14"></line>
      </svg>
      <span>成績</span>
    </button>
  </nav>

  <!-- 科目・回数別検索ポップアップ -->
  <div class="search-modal" id="searchModal">
    <div class="search-modal-backdrop" id="searchModalBackdrop"></div>
    <div class="search-modal-content">
      <div class="search-modal-header">
        <h2>科目・回数別検索</h2>
        <button class="btn-icon" id="closeSearchModalBtn" aria-label="閉じる">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="search-modal-body">
        <!-- キーワード検索 -->
        <div class="search-section">
          <label>問題番号・キーワード検索</label>
          <div class="search-input-row">
            <input type="text" id="searchKeyword" class="search-input" placeholder="例: 117-A001, 歯周病">
            <button class="btn-search" id="searchBtn">検索</button>
          </div>
        </div>

        <!-- 詳細設定（折りたたみ） -->
        <div class="search-details-section">
          <button class="search-details-toggle" id="searchDetailsToggle">
            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            詳細設定
          </button>
          <div class="search-details-body collapsed" id="searchDetailsBody">
            <!-- 演習状態 -->
            <div class="search-filter-group">
              <label>演習状態</label>
              <div class="filter-buttons" id="practiceStatusFilter">
                <button class="filter-btn active" data-value="unanswered">未演習</button>
                <button class="filter-btn active" data-value="correct">直近○</button>
                <button class="filter-btn active" data-value="incorrect">直近×</button>
              </div>
            </div>

            <!-- 問題区分 -->
            <div class="search-filter-group">
              <label>問題区分</label>
              <div class="filter-buttons" id="questionTypeFilter">
                <button class="filter-btn active" data-value="hisshu">必修</button>
                <button class="filter-btn active" data-value="ippan">一般</button>
                <button class="filter-btn active" data-value="rinjitsu">臨実</button>
              </div>
            </div>

            <!-- 回数選択 -->
            <div class="search-filter-group">
              <div class="filter-label-row">
                <label>回数選択</label>
                <div class="filter-actions">
                  <button class="filter-action-btn" data-action="selectAll" data-target="examFilter">全選択</button>
                  <button class="filter-action-btn" data-action="clearAll" data-target="examFilter">全解除</button>
                </div>
              </div>
              <div class="filter-buttons exam-buttons" id="examFilter">
                <button class="filter-btn active" data-value="118">118</button>
                <button class="filter-btn active" data-value="117">117</button>
                <button class="filter-btn active" data-value="116">116</button>
                <button class="filter-btn active" data-value="115">115</button>
                <button class="filter-btn active" data-value="114">114</button>
                <button class="filter-btn active" data-value="113">113</button>
                <button class="filter-btn active" data-value="112">112</button>
                <button class="filter-btn active" data-value="111">111</button>
                <button class="filter-btn active" data-value="110">110</button>
                <button class="filter-btn active" data-value="109">109</button>
                <button class="filter-btn active" data-value="108">108</button>
                <button class="filter-btn active" data-value="107">107</button>
                <button class="filter-btn active" data-value="106">106</button>
                <button class="filter-btn active" data-value="105">105</button>
                <button class="filter-btn active" data-value="104">104</button>
                <button class="filter-btn active" data-value="103">103</button>
                <button class="filter-btn active" data-value="102">102</button>
                <button class="filter-btn active" data-value="101">101</button>
                <button class="filter-btn active" data-value="100">100</button>
              </div>
            </div>

            <!-- 科目選択 -->
            <div class="search-filter-group">
              <div class="filter-label-row">
                <label>科目選択</label>
                <div class="filter-actions">
                  <button class="filter-action-btn" data-action="selectAll" data-target="subjectFilter">全選択</button>
                  <button class="filter-action-btn" data-action="clearAll" data-target="subjectFilter">全解除</button>
                </div>
              </div>
              <div class="filter-buttons subject-filter-buttons" id="subjectFilter">
                <button class="filter-btn active" data-value="解剖学">解剖学</button>
                <button class="filter-btn active" data-value="組織学">組織学</button>
                <button class="filter-btn active" data-value="病理学">病理学</button>
                <button class="filter-btn active" data-value="生理学">生理学</button>
                <button class="filter-btn active" data-value="生化学">生化学</button>
                <button class="filter-btn active" data-value="微生物学">微生物学</button>
                <button class="filter-btn active" data-value="薬理学">薬理学</button>
                <button class="filter-btn active" data-value="歯科理工学">歯科理工学</button>
                <button class="filter-btn active" data-value="衛生">衛生</button>
                <button class="filter-btn active" data-value="保存修復学">保存修復学</button>
                <button class="filter-btn active" data-value="歯内療法学">歯内療法学</button>
                <button class="filter-btn active" data-value="歯周病学">歯周病学</button>
                <button class="filter-btn active" data-value="有床義歯補綴学">有床義歯</button>
                <button class="filter-btn active" data-value="冠橋補綴学">冠橋補綴</button>
                <button class="filter-btn active" data-value="インプラント">インプラント</button>
                <button class="filter-btn active" data-value="口腔外科学">口腔外科</button>
                <button class="filter-btn active" data-value="矯正歯科学">矯正</button>
                <button class="filter-btn active" data-value="小児歯科学">小児</button>
                <button class="filter-btn active" data-value="高齢者歯科学">高齢者</button>
                <button class="filter-btn active" data-value="障害者歯科学">障害者</button>
                <button class="filter-btn active" data-value="放射線学">放射線</button>
                <button class="filter-btn active" data-value="麻酔学">麻酔</button>
                <button class="filter-btn active" data-value="総合医学">総合医学</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="search-modal-footer">
        <button class="btn-start-quiz" id="startFilteredQuizBtn">この条件で出題</button>
        <button class="btn-clear-conditions" id="clearConditionsBtn">条件クリア</button>
      </div>
    </div>
  </div>

  <!-- 画像モーダル -->
  <div class="image-modal" id="imageModal">
    <div class="image-modal-backdrop" id="imageModalBackdrop"></div>
    <div class="image-modal-content">
      <button class="image-modal-close" id="imageModalClose" aria-label="閉じる">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="image-modal-nav">
        <button class="image-modal-prev" id="imageModalPrev" aria-label="前の画像">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button class="image-modal-next" id="imageModalNext" aria-label="次の画像">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      <img id="imageModalImg" class="image-modal-img" src="" alt="問題画像">
      <div class="image-modal-counter" id="imageModalCounter"></div>
    </div>
  </div>

  <!-- まとめモーダル -->
  <div class="summary-modal" id="summaryModal" style="display: none;">
    <div class="summary-modal-backdrop" id="summaryModalBackdrop"></div>
    <div class="summary-modal-content">
      <div class="summary-modal-header">
        <h2 id="summaryModalTitle">まとめ</h2>
        <button class="summary-modal-close" id="summaryModalClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="summary-modal-body" id="summaryModalBody"></div>
    </div>
  </div>

  <!-- デッキ作成/編集モーダル -->
  <div class="deck-modal" id="deckModal" style="display: none;">
    <div class="deck-modal-backdrop" id="deckModalBackdrop"></div>
    <div class="deck-modal-content">
      <div class="deck-modal-header">
        <h2 id="deckModalTitle">新規デッキ作成</h2>
        <button class="deck-modal-close" id="deckModalClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="deck-modal-body">
        <div class="form-group">
          <label for="deckNameInput">デッキ名 *</label>
          <input type="text" id="deckNameInput" class="form-input" placeholder="例：解剖学 基礎">
        </div>
        <div class="form-group">
          <label for="deckDescInput">説明（任意）</label>
          <textarea id="deckDescInput" class="form-textarea" placeholder="デッキの説明を入力..." rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="deckTagsInput">タグ（任意、カンマ区切り）</label>
          <input type="text" id="deckTagsInput" class="form-input" placeholder="例：解剖学, 基礎, 筋肉">
        </div>
      </div>
      <div class="deck-modal-footer">
        <button class="btn-cancel" id="deckModalCancel">キャンセル</button>
        <button class="btn-save" id="deckModalSave">保存</button>
      </div>
    </div>
  </div>

  <!-- カード作成/編集モーダル -->
  <div class="card-modal" id="cardModal" style="display: none;">
    <div class="card-modal-backdrop" id="cardModalBackdrop"></div>
    <div class="card-modal-content">
      <div class="card-modal-header">
        <h2 id="cardModalTitle">カード追加</h2>
        <button class="card-modal-close" id="cardModalClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="card-modal-body">
        <div class="form-group">
          <label for="cardFrontInput">表面（質問） *</label>
          <textarea id="cardFrontInput" class="form-textarea" placeholder="質問を入力..." rows="4"></textarea>
        </div>
        <div class="form-group">
          <label for="cardBackInput">裏面（答え） *</label>
          <textarea id="cardBackInput" class="form-textarea" placeholder="答えを入力..." rows="4"></textarea>
        </div>
        <div class="form-group">
          <label for="cardTagsInput">タグ（任意、カンマ区切り）</label>
          <input type="text" id="cardTagsInput" class="form-input" placeholder="例：神経, 重要">
        </div>
      </div>
      <div class="card-modal-footer">
        <button class="btn-cancel" id="cardModalCancel">キャンセル</button>
        <button class="btn-save" id="cardModalSave">保存</button>
      </div>
    </div>
  </div>

  <!-- 削除確認モーダル -->
  <div class="confirm-modal" id="confirmModal" style="display: none;">
    <div class="confirm-modal-backdrop" id="confirmModalBackdrop"></div>
    <div class="confirm-modal-content">
      <div class="confirm-modal-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <h3 id="confirmModalTitle">削除の確認</h3>
      <p id="confirmModalMessage">本当に削除しますか？この操作は取り消せません。</p>
      <div class="confirm-modal-buttons">
        <button class="btn-cancel" id="confirmModalCancel">キャンセル</button>
        <button class="btn-danger" id="confirmModalConfirm">削除</button>
      </div>
    </div>
  </div>

  <!-- 模試成績登録モーダル -->
  <div class="mock-modal" id="mockExamModal" style="display: none;">
    <div class="mock-modal-backdrop" id="mockModalBackdrop"></div>
    <div class="mock-modal-content">
      <div class="mock-modal-header">
        <h2 id="mockModalTitle">模試成績を登録</h2>
        <button class="mock-modal-close" id="mockModalClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="mock-modal-body">
        <div class="form-group">
          <label for="mockNameInput">模試名 *</label>
          <input type="text" id="mockNameInput" class="form-input" placeholder="例：第3回全国模試">
        </div>
        <div class="form-group">
          <label for="mockDateInput">受験日 *</label>
          <input type="date" id="mockDateInput" class="form-input">
        </div>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="mockTotalScoreInput">総合点数 *</label>
            <input type="number" id="mockTotalScoreInput" class="form-input" placeholder="180">
          </div>
          <div class="form-group form-group-half">
            <label for="mockTotalMaxInput">満点 *</label>
            <input type="number" id="mockTotalMaxInput" class="form-input" placeholder="300">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="mockHisshuScoreInput">必修点数</label>
            <input type="number" id="mockHisshuScoreInput" class="form-input" placeholder="65">
          </div>
          <div class="form-group form-group-half">
            <label for="mockHisshuMaxInput">満点</label>
            <input type="number" id="mockHisshuMaxInput" class="form-input" placeholder="80">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="mockIppanScoreInput">一般点数</label>
            <input type="number" id="mockIppanScoreInput" class="form-input" placeholder="90">
          </div>
          <div class="form-group form-group-half">
            <label for="mockIppanMaxInput">満点</label>
            <input type="number" id="mockIppanMaxInput" class="form-input" placeholder="150">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="mockRinjitsuScoreInput">臨実点数</label>
            <input type="number" id="mockRinjitsuScoreInput" class="form-input" placeholder="25">
          </div>
          <div class="form-group form-group-half">
            <label for="mockRinjitsuMaxInput">満点</label>
            <input type="number" id="mockRinjitsuMaxInput" class="form-input" placeholder="70">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="mockRankInput">順位</label>
            <input type="text" id="mockRankInput" class="form-input" placeholder="例：150/3000">
          </div>
          <div class="form-group form-group-half">
            <label for="mockDeviationInput">偏差値</label>
            <input type="number" id="mockDeviationInput" class="form-input" placeholder="55" step="0.1">
          </div>
        </div>
        <div class="form-group">
          <label for="mockMemoInput">メモ</label>
          <textarea id="mockMemoInput" class="form-textarea" placeholder="振り返りや気づきを記録..." rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="mockImageInput">成績表画像</label>
          <div class="mock-image-upload" id="mockImageUpload">
            <input type="file" id="mockImageInput" accept="image/*" style="display: none;">
            <div class="mock-image-preview" id="mockImagePreview" style="display: none;">
              <img id="mockImagePreviewImg" src="" alt="プレビュー">
              <button class="mock-image-remove" id="mockImageRemove" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="mock-image-placeholder" id="mockImagePlaceholder">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              <span>タップして画像を選択</span>
            </div>
          </div>
        </div>
      </div>
      <div class="mock-modal-footer">
        <button class="btn-cancel" id="mockModalCancel">キャンセル</button>
        <button class="btn-save" id="mockModalSave">保存</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC8NhOUIsoeXv8-E4LqH2LzCe5D8w4PXqs",
      authDomain: "dental-exam-study.firebaseapp.com",
      projectId: "dental-exam-study",
      storageBucket: "dental-exam-study.firebasestorage.app",
      messagingSenderId: "565108124653",
      appId: "1:565108124653:web:07187c682540edf9d415e4",
      measurementId: "G-MTLKBN321Q"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // グローバルに公開
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseProvider = provider;
    window.firebaseFunctions = {
      signInWithPopup,
      onAuthStateChanged,
      signOut,
      doc,
      getDoc,
      setDoc,
      updateDoc,
      serverTimestamp
    };
  </script>

  <!-- ログインページ（招待コード入力） -->
  <div class="login-page" id="loginPage">
    <div class="login-container">
      <div class="login-header">
        <div class="login-icon">
          <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
        </div>
        <h1 class="login-title">歯科医師国家試験<br>対策アプリ</h1>
        <p class="login-subtitle">学習を始めるには招待コードを入力してください</p>
      </div>

      <div class="login-form">
        <div class="login-input-group">
          <label for="inviteCodeInput">招待コード</label>
          <input type="text" id="inviteCodeInput" class="login-input" placeholder="招待コードを入力" maxlength="20" autocomplete="off">
        </div>
        <button class="btn-login-submit" id="inviteSubmitBtn">ログイン</button>
      </div>

      <div class="login-error-area" id="loginErrorArea">
        <p class="login-error-title" id="loginErrorTitle"></p>
        <div class="login-error-details" id="loginErrorDetails"></div>
      </div>

      <div class="login-footer">
        <p>招待コードをお持ちでない方は<br>管理者にお問い合わせください</p>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
